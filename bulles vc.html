<!DOCTYPE html><html><head>
	<title></title>
	<meta name='viewport' content='width=device-width,initial-scale=1'/>
	<meta charset='utf-8'/>
	<!--
	<base target='blank' href='../site-dp/'/>
	<link rel='icon' type='image/x-icon' href='../site-dp/data/nounours-perso.svg'/>
	<link rel='icon' type='image/svg+xml' href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='16' height='16'><circle cx='8' cy='8' r='6' style='fill:#FBD;stroke:#C36'/></svg>">
	-->
	<link rel='icon' type='image/svg+xml' href='../site-dp/data/nounours-perso.svg'/>
	<link rel='stylesheet' type='text/css' href='../site-dp/library-css/structure.css'/>
	<link rel='stylesheet' type='text/css' href='../site-dp/library-css/perso.css' media='screen'/>
<style type='text/css'>
	body {
		width: 18cm;
		height: 18cm;
		padding: 0;
	}
	p {
		width: 60px;
		height: 60px;
		margin: 0;
		margin-bottom: 0;
	/*	border-radius: 50%; */
		background-color: green;
		cursor: move;
		position: absolute;
		left: 0px;
		top: 0px;
	}
	p.obstacle {
		background-color: cadetblue;
		left: 100px;
		top: 100px;
	}
</style></head><body>
	<p onmousedown='selectElement(this)'></p>
	<p class='obstacle'></p>
</body><script type='text/javascript'>
	var paragraph = document.getElementsByTagName ('p')[0];
	var currentX =0;
	var currentY =0;

	function selectElement (paragraph){
		currentX = event.screenX;
		currentY = event.screenY;
		paragraph.setAttribute ('onmousemove', 'moveElement(this)');
		paragraph.setAttribute ('onmouseup', 'deselectElement(this)');
	}
	function deselectElement (paragraph){
		paragraph.removeAttribute ('onmousemove');
		paragraph.removeAttribute ('onmouseup');
	}
	function moveElement (paragraph){
		var dx= event.screenX - currentX;
		var dy= event.screenY - currentY;
		paragraph.drag (dx, dy);
		currentX = event.screenX;
		currentY = event.screenY;
	}
	HTMLElement.prototype.drag = function (dx, dy){
		var pos = this.getPos();
		dx = pos[0] + dx;
		dy = pos[1] + dy;
		pos = this.senseObstacle (dx, dy);
		this.style.left = pos[0] + 'px';
		this.style.top = pos[1] + 'px';
	}
	String.prototype.fromPxToNb = function(){
		// nbStr = 12px
		const nbStr = this.slice (0, -2);
		var nbInt = parseInt (nbStr);
		return nbInt;
	}
	HTMLElement.prototype.getPos = function(){
		const style = window.getComputedStyle (this);
		var dx= style.left.fromPxToNb();
		var dy= style.top.fromPxToNb();
		/*/ v√©rifier que l'on reste dans le cadre
		const parentStyle = window.getComputedStyle (this.parentElement);
		if (dx <0) dx=0;
		else{
			const tmp = this.parentElement.clientWidth - this.offsetWidth;
			if (dx > tmp) dx= tmp;
		}
		if (dy <0) dy=0;
		else{
			const tmp = this.parentElement.clientHeight - this.offsetHeight;
			if (dy > tmp) dy= tmp;
		}*/
		return [ dx, dy ];
	}
	HTMLElement.prototype.senseObstacle = function (dx, dy){
		var pos =[ dx, dy ];
		for (var c=0; c< this.parentElement.children.length; c++){
			if (this.parentElement.children[c] !== this){
				const coordsBro = this.parentElement.children[c].getPos();
				if (dx < coordsBro[0] && coordsBro[0] < dx + this.clientWidth){
					if (dy < coordsBro[1] && coordsBro[1] < dy + this.clientHeight)
						pos[0] = coordsBro[0] - this.clientWidth;
					else if (dy < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < dy + this.clientHeight)
						pos[0] = coordsBro[0] - this.clientWidth;
				}
				else if (dx < coordsBro[0] + this.parentElement.children[c].clientWidth && coordsBro[0] + this.parentElement.children[c].clientWidth < dx + this.clientWidth){
					if (dy < coordsBro[1] && coordsBro[1] < dy + this.clientHeight)
						pos[0] = coordsBro[0] + this.parentElement.children[c].clientWidth;
					else if (dy < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < dy + this.clientHeight)
						pos[0] = coordsBro[0] + this.parentElement.children[c].clientWidth;
		}}}
		return pos;
	}
	HTMLElement.prototype.senseObstacle_vb = function(){
		const coords = this.getPos();
		for (var c=0; c< this.parentElement.children.length; c++){
			if (this.parentElement.children[c] !== this){
				const coordsBro = this.parentElement.children[c].getPos();
				if (coords[0] < coordsBro[0] && coordsBro[0] < coords[0] + this.clientWidth){
					if (coords[1] < coordsBro[1] && coordsBro[1] < coords[1] + this.clientHeight)
						this.style.left = (coordsBro[0] - this.clientWidth) + 'px';
					else if (coords[1] < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < coords[1] + this.clientHeight)
						this.style.left = (coordsBro[0] - this.clientWidth) + 'px';
				}
				else if (coords[0] < coordsBro[0] + this.parentElement.children[c].clientWidth && coordsBro[0] + this.parentElement.children[c].clientWidth < coords[0] + this.clientWidth){
					if (coords[1] < coordsBro[1] && coordsBro[1] < coords[1] + this.clientHeight)
						this.style.left = (coordsBro[0] + this.parentElement.children[c].clientWidth) + 'px';
					else if (coords[1] < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < coords[1] + this.clientHeight)
						this.style.left = (coordsBro[0] + this.parentElement.children[c].clientWidth) + 'px';
	}}}}
	HTMLElement.prototype.senseObstacle_va = function(){
		const coords = this.getPos();
		for (var c=0; c< this.parentElement.children.length; c++){
			if (this.parentElement.children[c] !== this){
				const coordsBro = this.parentElement.children[c].getPos();
				if (coords[0] < coordsBro[0] && coordsBro[0] < coords[0] + this.clientWidth){
					if (coords[1] < coordsBro[1] && coordsBro[1] < coords[1] + this.clientHeight)
						console.log ('xya', coords);
					else if (coords[1] < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < coords[1] + this.clientHeight)
						console.log ('xyb', coords);
				}
				else if (coords[0] < coordsBro[0] + this.parentElement.children[c].clientWidth && coordsBro[0] + this.parentElement.children[c].clientWidth < coords[0] + this.clientWidth){
					if (coords[1] < coordsBro[1] && coordsBro[1] < coords[1] + this.clientHeight)
						console.log ('xyc', coords);
					else if (coords[1] < coordsBro[1] + this.parentElement.children[c].clientHeight && coordsBro[1] + this.parentElement.children[c].clientHeight < coords[1] + this.clientHeight)
						console.log ('xyd', coords);
	}}}}
	console.log (document.getElementsByTagName ('p')[1].getPos());
</script></html>
