<!DOCTYPE html><html><head>
	<title>calendrier</title>
	<meta name='viewport' content='width=device-width,initial-scale=1'/>
	<meta charset='utf-8'/>
	<base target='blank' href='site-dp/'/>
	<link rel='icon' type='image/svg+xml' href='data/nounours-perso.svg'/>
	<link rel='stylesheet' type='text/css' href='library-css/structure.css'/>
	<link rel='stylesheet' type='text/css' href='library-css/perso.css' media='screen'/>
	<link rel='stylesheet' type='text/css' href='../calendrier.css'/>
	<script type='text/javascript' src='library-js/tag.js'></script>
	<script type='text/javascript' src='library-js/list.js'></script>
	<script type='text/javascript' src='../calendrier.js'></script>
<style type='text/css'></style></head><body>
	<div id='calendar'>
		<span></span><span></span>
		<p>l</p><p>m</p><p>m</p><p>j</p><p>v</p><p>s</p><p>d</p>
	</div>
	<div id='day'><span></span><button onClick='closing(this)'>X</button></div>
</body>
<script type='text/javascript'>
const year =2024;
const firstDayYear = DayWeek.mardi;
const eventList =[[ '01/02', 'coucou' ], [ '01/05', 'bonjour mon lapin' ], [ '01/05', 'bonsoir mon canard' ]];

dateFromString = function (text){
	var tableau = text.split ('/');
	var monthId =0;
	var dayId =0;
	if (tableau.length ==2){
		monthId = parseInt (tableau[0]);
		dayId = parseInt (tableau[1]);
	}
	else if (tableau.length ==3){
		monthId = parseInt (tableau[1]);
		if (tableau[0].length ==4) dayId = parseInt (tableau[2]);
		else dayId = parseInt (tableau[0]);
	}
	return [monthId, dayId];
}
class MonthEnum{
	static janvier = new Month (1, 'janvier', 31);
	static fevrier = new Month (2, 'février', 28);
	static mars = new Month (3, 'mars', 31);
	static avril = new Month (4, 'avril', 30);
	static mai = new Month (5, 'mai', 31);
	static juin = new Month (6, 'juin', 30);
	static juillet = new Month (7, 'juillet', 31);
	static aout = new Month (8, 'août', 31);
	static septembre = new Month (9, 'septembre', 30);
	static octobre = new Month (10, 'octobre', 31);
	static novembre = new Month (11, 'novembre', 30);
	static decembre = new Month (12, 'décembre', 31);

	constructor (id, name, duration){
		this.id = id;
		this.name = name;
		this.duration = duration;
		if (id==2 && isYearBissextile (year)) this.duration =29;
		this.dayWeek = null;
		this.getDayWeek (firstDayYear);
	}
	getById = function (id){
		if (id ==1) return MonthEnum.janvier;
		else if (id ==2) return MonthEnum.fevrier;
		else if (id ==3) return MonthEnum.mars;
		else if (id ==4) return MonthEnum.avril;
		else if (id ==5) return MonthEnum.mai;
		else if (id ==6) return MonthEnum.juin;
		else if (id ==7) return MonthEnum.juillet;
		else if (id ==8) return MonthEnum.aout;
		else if (id ==9) return MonthEnum.septembre;
		else if (id ==10) return MonthEnum.octobre;
		else if (id ==11) return MonthEnum.novembre;
		else if (id ==12) return MonthEnum.decembre;
		else return null;
	}
	static get = function (id){ return MonthEnum.janvier.getById (id); }
	nbDaySinceYearStart = function(){
		var nbDays =0;
		for (var m=1; m< this.id; m++){
			var month = this.getById (m);
			nbDays += MonthEnum.duration;
		}
		return nbDays;
	}
	getDayWeek = function (firstDayYear){
		var nbDays = this.nbDaySinceYearStart();
		nbDays += firstDayYear.id;
		nbDays = nbDays %7;
		this.dayWeek = DayWeek.get (nbDays);
	}
	draw = function(){
		var calendar = document.getElementById ('calendar');
		var titleList = calendar.getElementsByTagName ('span');
		titleList[0].innerHTML = this.name;
		titleList[1].innerHTML = year;
		for (var d=1; d< this.dayWeek.id; d++) createNode ('p', "", calendar);
		for (var d=1; d<= this.duration; d++){
			var button = createNode ('button', d, calendar);
			button.setAttribute ('onClick', 'openDay('+ this.id +', '+ d +')');
		}
	}
}
class Day{
	constructor (monthId, id){
		this.monthId = monthId;
		this.id = id;
		this.color ="";
		this.events =[];
		this.dayWeek = null;
	}
	draw = function(){
		this.getDayWeek();
		var day = document.getElementById ('day');
		var title = day.getElementsByTagName ('span')[0];
		title.innerHTML = this.dayWeek.name +' '+ this.id +' '+ MonthEnum.get (this.monthId).name;
		day.style.display = 'block';
		for (var d=0; d<= this.events.length; d++) createNode ('p', this.events[d], day);
	}
	getDayWeek = function(){
		var nbDays = MonthEnum.get (this.monthId).dayWeek.id;
		nbDays += this.id -1;
		nbDays = nbDays %7;
		this.dayWeek = DayWeek.get (nbDays);
	}
	getEvents = function (eventList){
		const dayStr = this.toString();
		for (var e= eventList.length -1; e>=0; e--) if (dayStr == eventList[e][0]){
			this.events.push (eventList[e][1]);
			this.events.pop (e);
		}
		if (this.events.length >0) this.color = 'red';
	}
	toString = function(){
		var text = this.monthId +'/';
		if (this.monthId <10) text = '0'+ text;
		if (this.id <10) text = text +'0';
		text = text + this.id;
		return text;
	}
	fromString = function (text){
		var ids = dateFromString (text);
		this.monthId = ids[0];
		this.id = ids[1];
		this.getDayWeek();
	}
}
class MonthDay{
	constructor (month){
		this.month = month;
		this.days =[];
		for (var d=1; d<= this.MonthEnum.duration; d++){
			var day = new Day (this.MonthEnum.id, d);
			day.getDayWeek();
			this.days.push (day);
	}}
	getEvents = function (eventList){ for (var d=0; d<= this.days.length; d++) this.days[d].getEvents (eventList); }
}
function openDay (monthId, id){
	var today = new Day (monthId, id);
	today.draw();
}
MonthEnum.janvier.draw();
</script>
</html>
